<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Firebase Authentication</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
</head>
<body>
<h2>Firebase 인증 테스트</h2>
<button onclick="signInWithGoogle()">구글 로그인</button>
<div id="token"></div>

<script>
    // Firebase 설정
    const firebaseConfig = {
        apiKey: "AIzaSyAUmq13vBhW--SpC57YitbmnlWkgUunGks",
        authDomain: "localbuzz-8b483.firebaseapp.com",
        projectId: "localbuzz-8b483",
        storageBucket: "localbuzz-8b483.firebasestorage.app",
        messagingSenderId: "28208785090",
        appId: "1:28208785090:web:972bc3ed59185f1c013d5b",
        measurementId: "G-16SYDSNBPC"
    };

    // Firebase 초기화
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }

    async function signInWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            const result = await firebase.auth().signInWithPopup(provider);
            const idToken = await result.user.getIdToken(true);
            document.getElementById('token').innerHTML =
                `ID Token: ${idToken.substring(0, 50)}...`;

            // 토큰을 서버로 전송
            await sendTokenToServer(idToken);
        } catch (error) {
            console.error('로그인 에러:', error);
        }
    }

    async function sendTokenToServer(idToken) {
        try {
            const response = await fetch('http://localhost:8080/api/v1/auth/social-login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    provider: 'GOOGLE',
                    token: idToken
                })
            });
            const data = await response.json();
            console.log('서버 응답:', data);
        } catch (error) {
            console.error('서버 전송 에러:', error);
        }
    }
</script>
</body>
</html>